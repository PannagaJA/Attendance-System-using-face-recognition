<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYMPL SNAP | Automated Classroom Attendance System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #0d47a1;
            --accent-color: #2962ff;
            --background-color: #f8f9fa;
            --light-gray: #f2f2f2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
                        url('https://images.pexels.com/photos/267885/pexels-photo-267885.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #fff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow: auto;
        }

        /* Unified Header (Combined College Info and Project Header) */
        header {
            background: rgba(26, 35, 126, 0.95);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        header .college-info {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        header .college-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            margin-right: 15px;
            padding: 5px;
        }

        header .college-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        header .dept-name {
            font-size: 1.1rem;
            color: white;
            margin-top: 5px;
        }

        header h1 {
            font-size: 3rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent-color);
            letter-spacing: 2px;
        }

        header p {
            font-size: 1.2rem;
            font-weight: 400;
        }

        /* Content Section */
        .content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-width: 1000px;
            margin: 40px auto;
            animation: fadeInUp 1.5s ease-out;
        }

        .content h2 {
            color: var(--primary-color);
            font-size: 2.5rem;
            font-family: 'Montserrat', sans-serif;
            margin-bottom: 20px;
        }

        .content p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #333;
            text-align: center;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .button {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }

        footer {
            background-color: rgba(26, 35, 126, 0.9);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: auto;
            width: 100%;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1);
        }

        .contact-info p {
            margin: 10px 0;
            font-size: 1.1rem;
            color: #f8f9fa;
        }

        .contact-info a {
            color: #f8f9fa;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .contact-info a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chatbot Popup Button (floating) */
        .chatbot-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #0066ff;
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            z-index: 9999;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-popup:hover {
            background-color: #0052cc;
        }

        /* Chatbot Window */
        .chatbot {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 600px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            background-color: white;
            z-index: 10000;
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Header and Message Area (same as provided) */
        .header {
            background: linear-gradient(90deg, #0066ff, #003399);
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Buttons, Messages, and Input Styles (same as provided) */
        .buttons-container {
            display: flex;
            gap: 10px;
            padding: 10px;
            justify-content: center;
        }

        .input-container {
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
        }

        /* Dialog Styles */
        .dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

          .chatbot {
            width: 400px;
            height: 600px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            background-color: white;
          }
      
          .header {
            background: linear-gradient(90deg, #0066ff, #003399);
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          }
      
          .header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
          }
      
          .messages {
            flex-grow: 1;
            padding: 20px;
            background: #f9f9f9;
            overflow-y: auto;
            scroll-behavior: smooth;
          }
      
          .input-container {
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
          }
      
          .input-container input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            margin-right: 10px;
            outline: none;
            transition: border-color 0.3s;
          }
      
          .input-container input:focus {
            border-color: #0066ff;
          }
      
          .input-container button {
            background: #0066ff;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
          }
      
          .input-container button:hover {
            background: #0052cc;
          }
      
          .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.3s ease-in-out;
          }
      
          .message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
          }
      
          .message-content {
            max-width: 70%;
            padding: 10px;
            border-radius: 8px;
            line-height: 1.4;
          }
      
          .user-message {
            justify-content: flex-end;
          }
      
          .user-message .message-content {
            background: #23d61c;
            color: black;
          }
      
          .bot-message .message-content {
            background: #e0e0e0;
            color: #333;
          }
      
          .buttons-container {
            display: flex;
            gap: 10px;
            padding: 10px;
            justify-content: center;
          }
      
          .buttons-container button {
            flex-grow: 1;
            background: #f2f2f2;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
          }
      
          .buttons-container button:hover {
            background: #e0e0e0;
          }
      
          /* Dialog styles */
          .dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
          }
      
          .dialog-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
          }
      
          .dialog-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
          }
      
          .dialog-content button {
            background: #0066ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
          }
    </style>
</head>
<body>

    <!-- Unified Header (Combined College Info and Project Header) -->
    <header class="animate__animated animate__fadeIn">
        <div class="college-info">
            <img src="static/amc_logo.jpg" alt="SYMPL SNAP Logo" class="college-logo">
            <div>
                <div class="college-name">AMC Engineering College</div>
                <div class="dept-name">Department of CSE (AI & ML)</div>
            </div>
        </div>

        <h1>SYMPL SNAP</h1>
        <p>Your efficient and automated solution for classroom attendance using facial recognition.</p>
    </header>

    <!-- Content Section -->
    <div class="content animate__animated animate__fadeInUp">
        <h2>About the Project</h2>
        <p>SYMPL SNAP is an innovative attendance management system that utilizes facial recognition technology to automate the process of marking attendance in classrooms. Faculty can easily upload classroom images, and the system automatically recognizes students and marks attendance.</p>
        <p>This solution improves efficiency, accuracy, and saves valuable time for both faculty and students, ensuring a seamless experience.</p>
        
        <a href="{{ url_for('login') }}" class="button">Get Started</a>
    </div>

    <!-- Chatbot Popup -->
    <div id="chatbotPopup" class="chatbot-popup" onclick="toggleChatbot()">
        <span>ðŸ’¬</span>
    </div>
    
    <!-- Chatbot Window (initially hidden) -->
    <div id="chatbotWindow" class="chatbot" style="display: none;">
        <div class="header">
            <img src="static/amc_logo.jpg" alt="AMC Logo">
            AMC Attendance ChatBot
        </div>
        <div class="buttons-container">
            <button onclick="showReportIssueDialog()">ðŸ›  Report Issue</button>
            <button onclick="handleOption('generalHelp')">ðŸ’¬ General Help</button>
            <button onclick="handleOption('attendanceInfo')">ðŸ“Š Attendance Info</button>
        </div>
        <div id="messages" class="messages">
            <div class="message bot-message">
                <img src="static/image.png" alt="Bot">
                <div class="message-content">Hello! I'm the AMC Attendance ChatBot. How can I help you today?</div>
            </div>
        </div>
        <div class="input-container">
            <input id="userInput" type="text" placeholder="Type your message...">
            <button id="sendButton">Send</button>
        </div>

        <!-- Report Issue Dialog -->
        <div id="reportIssueDialog" class="dialog">
            <div class="dialog-content">
                <h2>Report Attendance Issue</h2>
                <input type="text" id="nameInput" placeholder="Enter your name (CAPITAL LETTERS)" required>
                <input type="text" id="usnInput" placeholder="Enter your USN (e.g., 1AM22CI079)" required>
                <textarea id="issueDescriptionInput" placeholder="Describe your issue" rows="4" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px;"></textarea>
                <button onclick="submitAttendanceIssue()">Submit Issue</button>
                <button onclick="closeReportIssueDialog()">Cancel</button>
            </div>
        </div>
    </div>
  

    <!-- Footer Section -->
    <footer>
        <div class="contact-info">
            <p>&copy; 2024 SYMPL SNAP. All Rights Reserved.</p>
            <p>Contact: <a href="mailto:amccseaiml2022@gmail.com">amccseaiml2022@gmail.com</a> | <a href="tel:+918660144040">+91-8660144040</a></p>
        </div>
    </footer>

    <script>
        // Toggle chatbot window visibility
        function toggleChatbot() {
            const chatbotWindow = document.getElementById("chatbotWindow");
            const isVisible = chatbotWindow.style.display === "flex";
            chatbotWindow.style.display = isVisible ? "none" : "flex";
        }
        
        let reportsFileContent = "";
        const messagesContainer = document.getElementById("messages");
        const userInput = document.getElementById("userInput");
        const sendButton = document.getElementById("sendButton");
        const reportIssueDialog = document.getElementById("reportIssueDialog");
        const nameInput = document.getElementById("nameInput");
        const usnInput = document.getElementById("usnInput");
        
        // Validate USN format
        function validateUSN(usn) {
            const usnRegex = /^1AM22CI\d{3}$/;
            return usnRegex.test(usn);
        }
        
        // Validate Name (All Caps)
        function validateName(name) {
            return /^[A-Z\s]+$/.test(name);
        }
        
        // Show report issue dialog
        function showReportIssueDialog() {
            reportIssueDialog.style.display = 'flex';
        }
        
        // Close report issue dialog
        function closeReportIssueDialog() {
            reportIssueDialog.style.display = 'none';
        }
        
        // Submit attendance issue
        function submitAttendanceIssue() {
            const name = nameInput.value.trim().toUpperCase();
            const usn = usnInput.value.trim();
            const issueDescription = document.getElementById("issueDescriptionInput").value.trim();
        
            // Validate inputs
            if (!validateName(name)) {
                alert("Name must be in CAPITAL LETTERS only!");
                return;
            }
        
            if (!validateUSN(usn)) {
                alert("Invalid USN format. It should be like 1AM22CI079!");
                return;
            }
        
            if (!issueDescription) {
                alert("Please provide a description of the issue.");
                return;
            }
        
            // Prepare the issue data with current date and time
            const currentDateTime = new Date().toLocaleString();
            const reportMessage = `Report Details:\nDate & Time: ${currentDateTime}\nName: ${name}\nUSN: ${usn}\nIssue: ${issueDescription}\n\n`;
            
            // Save the issue
            saveAttendanceIssue(reportMessage);
            
            // Add message to chat
            addMessage(`Attendance issue reported for ${name} (${usn})`, false);
            
            // Close dialog
            closeReportIssueDialog();
            
            // Clear input fields
            nameInput.value = '';
            usnInput.value = '';
            document.getElementById("issueDescriptionInput").value = '';
        }
        
        // Save attendance issue (download cumulative txt file)
        function saveAttendanceIssue(reportMessage) {
            // Append to cumulative file content
            reportsFileContent += reportMessage;
        
            // Create and download the file
            const blob = new Blob([reportsFileContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'attendance_issues.txt';
            link.click();
        }
        
        // Add a simple message to the chatbot window
        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById("messages");
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", isUser ? "user-message" : "bot-message");
            const img = document.createElement("img");
            img.src = isUser ? "static/user.png" : "static/image.png";
            messageDiv.appendChild(img);
            const messageContent = document.createElement("div");
            messageContent.classList.add("message-content");
            messageContent.textContent = content;
            messageDiv.appendChild(messageContent);
            messagesContainer.appendChild(messageDiv);
        }
        
        // Handling user input and chatbot responses
        sendButton.onclick = function() {
            const userInput = document.getElementById("userInput").value;
            if (userInput.trim() === "") return;
            addMessage(userInput, true);
            document.getElementById("userInput").value = "";
            setTimeout(() => {
                addMessage("Thanks for your message! How can I assist further?");
            }, 1000);
        }
        
        // Handle options in the chatbot
        function handleOption(option) {
            let response = "";
            switch (option) {
                case 'generalHelp':
                    response = "For any assistance, please refer to our FAQ section!";
                    break;
                case 'attendanceInfo':
                    response = "Please provide your details to check the attendance!";
                    break;
                default:
                    response = "I'm here to help. What would you like to know?";
            }
            addMessage(response);
        }
        
        // Submit issue for attendance via backend request
        function submitAttendanceIssueBackend() {
            const name = document.getElementById("nameInput").value;
            const usn = document.getElementById("usnInput").value;
            const description = document.getElementById("issueDescriptionInput").value;
            
            // Validate input fields
            if (!name || !usn || !description) {
                alert("Please fill in all the fields.");
                return;
            }
            
            // Prepare the data to send to the backend
            const issueData = {
                name: name,
                usn: usn,
                issue: description
            };
            
            // Send the issue data to the backend using fetch()
            fetch('/report_issue', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(issueData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Your issue has been submitted! You can download the report.");
                    // Redirect the user to download the report
                    window.location.href = data.download_link; // This is the link provided by the server
                } else {
                    alert('There was an issue submitting your report. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting your report. Please try again.');
            });
            
            // Close the report issue dialog after submission
            closeReportIssueDialog();
        }
    </script>
      
</body>
</html>
